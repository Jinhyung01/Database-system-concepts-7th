## 3.2 SQL 데이터 정의

DDL을 이용하면 DB의 릴레이션을 정의할 수 있다. 

SQL DDL은 릴레이션의 집합뿐만 아니라 다음과 같은 각 릴레이션에 관한 정보도 명세할 수 있게 해준다.

- 각 릴레이션의 스키마
- 각 속성값의 타입
- 무결성 제약 조건
- 각 릴레이션을 위해 만들어진 인덱스의 집합
- 각 릴레이션에 대한 보안 및 권한 부여 정보
- 디스크에 저장된 릴레이션의 물리적 저장 구조

<br/>

> 이 절에서는 스키마 정의와 타입 값에 대해서만 논의하겠다.

<br/>

<br/>

## 3.2.1 기본타입

SQL 표준은 다음의 다양한 내장 타입을 지원한다.

**``char(n)``**

- 사용자가 지정한 길이 n을 갖는 고정 길이 문자. 
- char 대신 character가 사용될 수도 있다.

<br/>

**``varchar(n)``**

- 사용자가 지정한 최대 길이 n을 갖는 가변 길이 문자.
- varchar 대신 character varying이 사용될 수도 있다.

<br/>

**``int``**

- 정수(시스템에 따라 달라질 수 있는 정수의 부분집합).
- int대신 integer가 사용될 수도 있다.

<br/>

**``smallint``**

- 작은 정수(시스템에 따라 달라질 수 있는 정수타입의 부분집합)

<br/>

**``numeric(p,d)``**

- 사용자가 지정한 정밀도(precision)를 갖는 고정 소수점 수(fixed-point number). 
- 수는 p개의 숫자(및 부호)로 구성되며, p개의 숫자 중 d개는 소수점 이하에 있는 숫자의 개수를 나타낸다. 
- 따라서 numeric(3,1)로 지정된 속성 혹은 열의 경우 44.5라는 값은 정확히 저장될 수 있지만 444.5나 0.32는 정확히 저장될 수 없다.

<br/>

**``real``**

- 시스템에 따라 달라질 수 있는 정밀도를 가지는 부동 소수점 수

<br/>

**``double precision``**

- 시스템에 따라 달라질 수 있는 정밀도를 가지는 배정밀도(double-precision) 부동 소수점 수

<br/>

**``float(n)``**

- 적어도 n개의 숫자로 나타낼 수 있는 정밀도를 갖는 부동 소수점 수

<br/>

> - [x] 각각의 타입은 null 값을 포함할 수 있다. 어떤 경우에는 널 값 입력 자체가 금지될 수도 있다.

> 추가적인 타입은 4.5절에서 다룬다.

<br/><br/>

### char타입과 varchar타입

``char`` 데이터 타입은 **고정 길이의 문자열**을 저장한다. 

예를들어, `char(10)` 타입의 속성 A에 `"Avi"`라는 문자열을 저장하면, 10문자 길이를 맞추기 위해 **7개의 공백이 추가된다**. 

<br/>

<br/>

``varchar`` 데이터 타입은 **가변 길이의 문자열**을 저장한다.

`varchar(10)` 타입의 속성 B에 `"Avi"`를 저장하면, **공백이 추가되지 않는다**. 

<br/>
<br/>

**``char`` 타입의 두 값을 비교할 때** 두 값의 길이가 다르면, 길이가 **짧은 값에 공백이 자동으로 추가**되어 두 값이 같은 크기가 되도록 만든다.

<br/>

그러나 **``char`` 타입과 ``varchar`` 타입을 비교할 때**는 **DB 시스템에 따라 ``varchar`` 타입의 값에 공백을 추가할 수도 안할 수도** 있어서 속성 A,B에 `"Avi"`라는 같은 값을 저장했다 하더라도 **A = B 비교 결과는 false가 될 수 있다**. 

<br/>
<br/>

이러한 문제를 없애기 위해 항상 char 타입 대신 **``varchar`` 타입을 사용하는 것을 추천**한다.

<br/>

또한 SQL은 ``nvarchar``타입을 제공해 **Unicode를 통해 다국어 데이터를 저장**할 수 있다.

많은 데이터베이스에서 사용하는 **`varchar`** 타입도 **UTF-8**을 통해 유니코드 문자를 지원하기에 다국어 데이터를 저장할 수 있다

<br/>

<br/>

## 3.2.2 기본 스키마 정의

SQL의 **create table** 문(statement)을 사용하여 **어떤 릴레이션을 정의**할 수 있다.

다음의 명령어는 department 릴레이션을 데이터베이스에 생성한다.

```sql
create table department
    (dept_name varchar(20),
     building  varchar(15),
     budget    numeric(12,2),
     primary key (dept_name));
```

위에서 만든 릴레이션은 세 개의 속성을 가지고 있다.

- dept_name : 최대 길이가 20인 문자열
- building : 최대 길이가 15인 문자열
- budget : 12개의 숫자로 구성되는데, 그중 두개는 소수점 이하 숫자

<br/>

create table문은 또한 dept_name이 릴레이션의 **주 키**임을 나타낸다.

<br/>
<br/>

create table 문의 **일반 구문**은 다음과 같다.

```sql
create table r
	(A1, D1,
	 A2, D2,
	 ...
	 An, Dn,
	 <integritiy-constraint1>
	 ...,
	 <integritiy-constratintk>
    );
```

**r** : 릴레이션 이름

**Ai** : 릴레이션 r의 스키마 속성의 이름

**Di** : 속성 Ai의 도메인

>  create table 문의 끝에 있는 **세미콜론(;)**은 DBMS에 따라 필요할 수도 있고 필요 없을 수도 있다.

<br/>

<br/>

SQL은 서로 다른 다수의 **무결성 제약 조건**을 지원한다.

> 이 절은 그중 일부만 다룬다.

- **primary key**(Aj1, Aj2, ..., Ajm) 
  - 이 주 키(primary key) 명세는 속성 Aj1, Aj2, ..., Ajm 등이 **릴레이션의 주 키를 구성**한다는 것을 나타낸다.
  - 주 키 속성은 **null이 아니거나 유일**해야한다.

<br/>

- **foreign key**(Ak1, Ak2, ..., Akn) **references s**
  - 외래 키(foreign key) 명세는 **릴레이션의 어떤 튜플에 대한 속성값**(Ak1, Ak2, ..., Akn)이 반드시 (상대)릴레이션 s가 갖고 있는 일부 튜플의 **주 키 속성값에 상응**해야한다.
  - course릴레이션에서 외래 키 선언은 각 course 튜플에 대해 그 튜플이 지정한 학과 이름은 반드시 department 릴레이션의 주 키 속성인 (dept_name)에 존재해야 한다는 것을 의미한다. 

<br/>

- **not null**
  - 속성에 대한 not null 제약 조건은 **그 속성의 도메인에서 null 값을 제외**한다.
  - instructor 릴레이션의 name 속성에 대한 **not null 제약 조건**은 **교수의 이름이 null이 될 수 없음을 보장**한다.

<br/>

#### 대학교 데이터베이스의 일부 SQL DDL 정의

![그림 3 1 대학교 데이터베이스의 일부분에 대한 SQL 데이터 정의](https://github.com/user-attachments/assets/72aa357d-c170-4556-8a8c-a0313bf44909)

 <br/>

<br/>

SQL은 **무결성 제약 조건을 위반하는 모든 DB 갱신을 막는다**.

> 예시 :  릴레이션에 새롭게 추가되거나 수정된 튜플이 주 키 속성에 대해 null 값을 가지거나, 혹은 튜플이 주 키 속성에 대해 릴레이션 내의 다른 튜플과 같은 값을 가지게 되면 SQL이 오류를 표시하고 해당 갱신을 막는다. 유사하게 department 릴레이션에 없는 dept_name을 갖는 course 튜플의 삽입은 course에 대한 외래 키 제약 조건 때문에 거절된다.

<br/>

<br/>

### 데이터 조작 명령어

- 튜플 삽입 : `insert`
- 튜플 갱신 : `update`
- 튜플 삭제 : `delete`

> 새로 생성되는 릴레이션은 초기에는 비어 있다.

<br/>

<br/>

### 릴레이션을 제거하기 위한 명령문

**`drop table` 문** 

- drop table은 데이터베이스에서 제거될 릴레이션과 관련된 모든 정보를 삭제한다.

- 사용 예시

  - ```sql
    drop table r;
    ```

<br/>

<br/>

**`delete from r;`과 차이점** 

- `delete from r;`
  - 릴레이션 **r의 모든 튜플을 제거**하지만, **릴레이션 자체는 남아 있음**.

<br/>

- `drop table r;`

  - 릴레이션 **r의 모든 튜플과 스키마까지 삭제**.

  - 릴레이션이 삭제되면 다시 `create table`을 사용하지 않으면 튜플 삽입 불가.

<br/>

<br/>

### 릴레이션 스키마(속성) 수정 명령어

**`alter table`문**

- 이미 존재하는 릴레이션에 속성을 추가할 수 있게 한다.

- 릴레이션의 모든 튜플에 새로운 속성값으로 null이 할당된다.

- alter table 구문은 다음과 같다.

  ```sql
  alter table r add A D;
  ```

  - **r**: 릴레이션 이름

    **A**: 추가될 속성의 이름

    **D**: 그 속성의 도메인

<br/>

- 릴레이션에 속성을 제거하려면 다음 구문을 사용할 수 있다.

  ```sql
  alter table r drop A;
  ```

  - **r**: 릴레이션 이름

    **A**: 제거될 속성의 이름